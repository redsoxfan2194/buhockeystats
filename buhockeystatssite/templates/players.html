<!DOCTYPE html>
<html lang="en" dir="ltr">
   <head>
      <meta charset="utf-8">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
      <link rel="stylesheet" href="{{ url_for('static', filename= 'css/style.css') }}">
      <title>BU Hockey Stats</title>
      <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
   </head>
   <body>
   <h1>BU Hockey Stats</h1>
  <h2 class="clickable-heading">
    <a class='link' href="/records">Records</a>
    <a class='link' href="/players">Players</a>
    <a class='link' href="/statsbot">Stats Bot</a>
  </h2>
      <input type = "submit" id='filterMenu' value = "&#9881&#xFE0E;"/>
      <div class="dropdown-container options-menu" id="options-menu">
         <form method="post" id="playerForm">
            <select class="btn btn-custom-red dropdown-toggle" name="gender" id="gender" onchange="clearFilers();this.form.submit()">
            <option value="Mens" {% if selected_gender == 'Mens' %} selected {% endif %} >Mens</option>
            <option value="Womens" {% if selected_gender == 'Womens' %} selected {% endif %}>Womens</option>
            </select>
            <select class="btn btn-custom-red dropdown-toggle" name="position" id="position" onchange="clearFilers();this.form.submit()">
            <option value="skater" {% if selected_position == 'skater' %} selected {% endif %}>Skaters</option>
            <option value="goalie" {% if selected_position == 'goalie' %} selected {% endif %}>Goalies</option>
            </select>
            <select class="btn btn-custom-red dropdown-toggle" name="type" id="type" onchange="clearFilers();this.form.submit()">
            <option value="career" {% if selected_type == 'career' %} selected {% endif %}>Career</option>
            <option value="season" {% if selected_type == 'season' %} selected {% endif %}>Season</option>
            <option value="game" {% if selected_type == 'game' %} selected {% endif %}>Game</option>
            </select>
            <input type="text" name="name" id="name" value="{{ name }}" placeholder="{{name}}" onchange="this.form.submit()">
            <input class="season-stats" type="number" name="number" id="number" value="{{ number }}" placeholder="{{number}}" min=1 max=99 onchange="this.form.submit()">
            <input type="hidden" id="isAscending" name="isAscending" value="{{isAscending}}">
            <input type="hidden" id="sortval" name="sortval" value="{{sortval}}">
            <select class="btn btn-custom-red dropdown-toggle skater-stats season-stats game-stats" name="pos" id="pos" onchange="this.form.submit()">
            <option value="all" {% if selected_pos == 'all' %} selected {% endif %}>Position</option>
            <option value="F" {% if selected_pos == 'F' %} selected {% endif %}>F</option>
            <option value="D" {% if selected_pos == 'D' %} selected {% endif %}>D</option>
            <option value="G" {% if selected_pos == 'G' %} selected {% endif %}>G</option>
            </select>
            <select class="btn btn-custom-red dropdown-toggle season-stats game-stats" name="yr" id="yr" onchange="this.form.submit()">
            <option value="all" {% if selected_yr == 'all' %} selected {% endif %}>YR</option>
            <option value="FR" {% if selected_yr == 'FR' %} selected {% endif %}>FR</option>
            <option value="SO" {% if selected_yr == 'SO' %} selected {% endif %}>SO</option>
            <option value="JR" {% if selected_yr == 'JR' %} selected {% endif %}>JR</option>
            <option value="SR" {% if selected_yr == 'SR' %} selected {% endif %}>SR</option>
            <option value="GR" {% if selected_yr == 'GR' %} selected {% endif %}>GR</option>
            </select>
            
            <select class="btn btn-custom-red dropdown-toggle game-stats" name="opponent" id="opponent" onchange="this.form.submit()">
            <option value="all" {% if selected_opponent == 'all' %} selected {% endif %}>Opponent</option>
            {% for opponent in opponents_values %}
            <option value="{{ opponent }}" {% if selected_opponent == opponent %} selected {% endif %}>{{ opponent }}</option>
            {% endfor %}
            </select>
            <select class="btn btn-custom-red dropdown-toggle" name="season" id="season" onchange="this.form.submit()">
            <option value="all" {% if selected_season == 'all' %} selected {% endif %}>Season</option>
            {% for season in season_values %}
            <option value="{{ season }}" {% if selected_season == season %} selected {% endif %}>{{ season }}</option>
            {% endfor %}
            </select>
            <input class="game-stats" type="text" name="date" id="date" value="{{ date }}" placeholder="{{date}}" onchange="this.form.submit()">
            <input type = "submit" id='resetButton' value = "Reset"  />
            <div class='dropdown-container'>
            <select class="btn btn-custom-red dropdown-toggle" name="seasonStart" id="seasonStart" onchange="this.form.submit()">
            {% for seasonStart in season_values %}
            <option value="{{ seasonStart }}" {% if selected_startSeas == seasonStart %} selected {% endif %}>{{ seasonStart }}</option>
            {% endfor %}
            </select>
            <p id='dash'>_</p>
            <select class="btn btn-custom-red dropdown-toggle" name="seasonEnd" id="seasonEnd" onchange="this.form.submit()">
            {% for seasonEnd in season_values %}
            <option value="{{ seasonEnd }}" {% if selected_endSeas == seasonEnd %} selected {% endif %}>{{ seasonEnd }}</option>
            {% endfor %}
            </select>
            </div>
            
          </form>
      </div>
      <div>
{% autoescape false %}
{{statTable}}
{% endautoescape %}
</div>
      <script>
         
         document.getElementById("resetButton").addEventListener("click", clearFilers);
         
         function clearFilers() {
           document.getElementById("pos").value = "all";
           document.getElementById("yr").value = "all";
           document.getElementById("season").value = "all";
           document.getElementById("opponent").value = "all";
           document.getElementById("seasonStart").value = "{{season_values[0]}}";
           document.getElementById("seasonEnd").value = "{{season_values[-1]}}";
           document.getElementById("sortval").value = "";
           document.getElementById("isAscending").value = "";
           document.getElementById("name").value = "Name";
           document.getElementById("number").value = "Number";
           document.getElementById("date").value = "Date";
           
         }
      </script>
<script>
      var positionSelect = document.querySelector('select[name="position"]');
      var typeSelect = document.querySelector('select[name="type"]');
      var skaterStats = document.getElementsByClassName('skater-stats');
      var seasonStats = document.getElementsByClassName('season-stats');
      var gameStats = document.getElementsByClassName('game-stats');
      // Hide all season stats
      const statsElements = document.querySelectorAll(".season-stats, .game-stats");

        // Hide all stats elements
        for (let i = 0; i < statsElements.length; i++) {
          statsElements[i].classList.add("hidden");
        }

        // Show stats elements based on the selected type
        if (typeSelect.value === "season") {
          for (let i = 0; i < seasonStats.length; i++) {
            seasonStats[i].classList.remove("hidden");
          }
        } else if (typeSelect.value === "game") {
          // Do nothing for game stats
            for (let i = 0; i < gameStats.length; i++) {
            gameStats[i].classList.remove("hidden");
          }
        }

</script>
    <script>
    var mobileButton = document.getElementById('filterMenu');
var hiddenDiv = document.getElementById('options-menu');

mobileButton.addEventListener('click', function() {
  if (hiddenDiv.style.display === 'none' || hiddenDiv.style.display === '' ) {
    hiddenDiv.style.display = 'block';
  } else {
    hiddenDiv.style.display = 'none';
  }
});
</script>
<script>
if(document.getElementById("sortval").value)
{
  var thElements = document.getElementsByTagName('th');
  var clickedText= document.getElementById("sortval").value;
      // Clear arrow from all other th elements
  for (var i = 0; i < thElements.length; i++) {
    var th = thElements[i];
    var thText = th.textContent || th.innerText;
    if (thText === clickedText) {
      var arrow = th.querySelector('.arrow');
        arrow = document.createElement('span');
        arrow.className = 'arrow';
        if(document.getElementById("isAscending").value==="false")
        {
          arrow.innerHTML = '▲'; // Up arrow unicode
        }
        else
        {
          arrow.innerHTML = '▼'; // down arrow unicode
        }
        th.appendChild(arrow);
        th.innerHTML += ' ';
      }
    }
  }


function setSort(header) {
  var columnName = header.innerHTML;
  console.log("Clicked column value:", columnName);
  if(!columnName)
    return;
  var thElements = document.getElementsByTagName('th');
  document.getElementById("sortval").value = columnName.replace("<span class=\"arrow\">▲</span> ","").replace("<span class=\"arrow\">▼</span> ","")

  // Clear arrow from all other th elements
  for (var i = 0; i < thElements.length; i++) {
    var th = thElements[i];
    if (th !== header) {
      var arrow = th.querySelector('.arrow');
      if (arrow) {
        th.removeChild(arrow);
        th.innerHTML = th.innerHTML.trim();
      }
    }
  }
  var arrow = header.querySelector('.arrow');
      
      if (arrow === null) {
        // Add up arrow
        arrow = document.createElement('span');
        arrow.className = 'arrow';
        arrow.innerHTML = '▲'; // Up arrow unicode
        
        header.appendChild(arrow);
        header.innerHTML += ' ';
        document.getElementById("isAscending").value = "false";
      } else if (arrow.innerHTML === '▲') {
        // Change to down arrow
        arrow.innerHTML = '▼'; // Down arrow unicode
        document.getElementById("isAscending").value = "true";
      } else {
        // Remove arrow
        header.removeChild(arrow);
        header.innerHTML = header.innerHTML.trim(); // Remove trailing space
        document.getElementById("isAscending").value = "";
      }
    document.getElementById("playerForm").submit();
    }
</script>
   </body>
</html>